

<!DOCTYPE html>
<html class="no-js" lang="en">

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width initial-scale=1" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title> Ports and protocols in Scylla | Scylla Docs
    </title>
    <meta name="description" content="Scylla is an Apache Cassandra-compatible NoSQL data store that can handle 1 million transactions per second on a single server." />
    <link
      rel="icon"
      href="../_static/img/favicon.ico"
      type="image/x-icon"
    />
    <link
      rel="icon"
      href="../_static/img/favicon-32x32.png"
      sizes="32x32"
    />
    <link
      rel="icon"
      href="../_static/img/favicon-228x228.png"
      sizes="192x192"
    />
    <link
      rel="apple-touch-icon"
      href="../_static/img/favicon-228x228.png"
    />
    <meta
      name="msapplication-TileImage"
      href="../_static/img/favicon-228x228.png"
    />
    <link rel="canonical" href="https://docs.scylladb.com/" />
    <link rel="author" href="mailto:info@scylladb.com" />
  <!-- connect to domain of font files -->
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />

  <!-- optionally increase loading priority -->
  <link
    rel="preload"
    as="style"
    href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,400;0,500;0,700;1,400&display=swap"
  />

  <!-- async CSS -->
  <link
    rel="stylesheet"
    media="print"
    onload="this.onload=null;this.removeAttribute('media');"
    href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,400;0,500;0,700;1,400&display=swap"
  />

  <!-- no-JS fallback -->
  <noscript>
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,400;0,500;0,700;1,400&display=swap"
    />
  </noscript>
  <link
    rel="stylesheet"
    href="../_static/css/main.css"
    type="text/css"
  />
  <link
    rel="stylesheet"
    href="../_static/pygments.css"
    type="text/css"
  /> <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />

  <script
    type="text/javascript"
    id="documentation_options"
    data-url_root="../"
    src="../_static/documentation_options.js"
  ></script>
  <script
    type="text/javascript"
    src="../_static/js/runtime.bundle.js"
  ></script>
  <script
    type="text/javascript"
    src="../_static/js/main.bundle.js"
  ></script> <script src="../_static/jquery.js"></script> <script src="../_static/underscore.js"></script> <script src="../_static/doctools.js"></script> <script src="../_static/language_data.js"></script> <script src="../_static/clipboard.min.js"></script> <script src="../_static/copybutton.js"></script>

    <!-- Google Tag Manager -->
    <script>
      (function (w, d, s, l, i) {
        w[l] = w[l] || [];
        w[l].push({ "gtm.start": new Date().getTime(), event: "gtm.js" });
        var f = d.getElementsByTagName(s)[0],
          j = d.createElement(s),
          dl = l != "dataLayer" ? "&l=" + l : "";
        j.async = true;
        j.src = "https://www.googletagmanager.com/gtm.js?id=" + i + dl;
        f.parentNode.insertBefore(j, f);
      })(window, document, "script", "dataLayer", "GTM-T8P2JP");
    </script>
    <!-- End Google Tag Manager -->
    <!-- Marketo -->
    <script type="text/javascript">
      (function () {
        var didInit = false;
        function initMunchkin() {
          if (didInit === false) {
            didInit = true;
            Munchkin.init("791-QBF-350");
          }
        }
        var s = document.createElement("script");
        s.type = "text/javascript";
        s.async = true;
        s.src = "//munchkin.marketo.net/munchkin.js";
        s.onreadystatechange = function () {
          if (this.readyState == "complete" || this.readyState == "loaded") {
            initMunchkin();
          }
        };
        s.onload = initMunchkin;
        document.getElementsByTagName("head")[0].appendChild(s);
      })();
    </script>
    <!-- End Marketo -->
    <!-- Expertrec -->
    <script>
      var id = "e2077224-9ccf-11e9-a0c9-0242ac130002";
      var ci_search = document.createElement("script");
      ci_search.type = "text/javascript";
      ci_search.async = true;
      ci_search.src = "https://cse.expertrec.com/api/js/ci_common.js?id=" + id;
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(ci_search, s);
    </script>
    <!-- End Expertrec -->

    <!-- Font Awesome -->
    <script
      src="https://kit.fontawesome.com/b1870adf6a.js"
      crossorigin="anonymous"
    ></script>
    <!-- End Font Awesome -->
  </head>
  
  <body>
     <header class="header">
  <div class="header-logo">
    <a class="header-logo__img" href="https://scylladb.com/">
      <img
        src="../_static/img/logo-scylla-docs.svg"
        alt="Scylla Documentation Logo"
      />
    </a>
    <span class="header-logo__bar"></span>
    <a class="header-logo__text" href="https://docs.scylladb.com/">
      Documentation
    </a>
  </div>
  <div class="header-navigation">
    <ul
      class="dropdown menu scylla-dropdown scylla-dropdown--header"
      data-dropdown-menu
    >
      <li class="scylla-dropdown__item">
        <a href="#" class="scylla-dropdown__title"
          >Server <i class="chevron scylla-icon scylla-icon--triangle-down"></i
        ></a>
        <ul class="menu scylla-dropdown__content">
          <li>
            <a href="https://docs.scylladb.com/"
              ><i class="scylla-icon scylla-icon--about-us"></i>Scylla Open
              Source</a
            >
          </li>
          <li>
            <a href="https://docs.scylladb.com/"
              ><i class="scylla-icon scylla-icon--enterprise"></i>Scylla
              Enterprise</a
            >
          </li>
          <li>
            <a
              href="https://scylla.docs.scylladb.com/master/alternator/alternator.html"
            >
              <i class="scylla-icon scylla-icon--overview"></i>Scylla
              Alternator</a
            >
          </li>
        </ul>
      </li>
      <li class="scylla-dropdown__item">
        <a href="#" class="scylla-dropdown__title"
          >Cloud <i class="chevron scylla-icon scylla-icon--triangle-down"></i
        ></a>
        <ul class="menu scylla-dropdown__content">
          <li>
            <a href="https://cloud.scylladb.com/">
              <i class="scylla-icon scylla-icon--cloud"></i>Scylla Cloud</a
            >
          </li>
          <li>
            <a href="https://docs.scylladb.com/scylla-cloud/">
              <i class="scylla-icon scylla-icon--cloud-docs"></i>Scylla Cloud
              Docs</a
            >
          </li>
        </ul>
      </li>
      <li class="scylla-dropdown__item">
        <a href="#" class="scylla-dropdown__title"
          >Tools <i class="chevron scylla-icon scylla-icon--triangle-down"></i
        ></a>
        <ul class="menu scylla-dropdown__content">
          <li>
            <a href="https://manager.docs.scylladb.com/">
              <i class="scylla-icon scylla-icon--manager"></i>Scylla Manager</a
            >
          </li>
          <li>
            <a href="https://monitoring.docs.scylladb.com/">
              <i class="scylla-icon scylla-icon--monitoring"></i>Scylla
              Monitoring Stack</a
            >
          </li>
          <li>
            <a href="https://operator.docs.scylladb.com/">
              <i class="scylla-icon scylla-icon--operator"></i>Scylla Operator
            </a>
          </li>
        </ul>
      </li>
      <li class="scylla-dropdown__item">
        <a href="#" class="scylla-dropdown__title"
          >Drivers <i class="chevron scylla-icon scylla-icon--triangle-down"></i
        ></a>
        <ul class="menu scylla-dropdown__content">
          <li>
            <a
              href="https://docs.scylladb.com/using-scylla/drivers/cql-drivers/"
            >
              <i class="scylla-icon scylla-icon--nsql-guides"></i>CQL Drivers
            </a>
          </li>
          <li>
            <a
              href="https://docs.scylladb.com/using-scylla/drivers/dynamo-drivers/"
            >
              <i class="scylla-icon scylla-icon--overview"></i>DynamoDB Drivers
            </a>
          </li>
        </ul>
      </li>
    </ul>
    <div class="header-button">
      <a href="https://www.scylladb.com/download/" class="button">Download</a>
    </div>
  </div>
  <div class="header-search-box">
    <div class="search-box">
      <ci-search></ci-search>
    </div>
  </div>
  <div class="side-nav-toggle" data-toggle="side-nav">
  <div class="side-nav-toggle__button">
    <img src="../_static/img/menu.svg" alt="Menu" />
  </div>
</div>
</header>
    <section class="layout ">
      <div class="content large-order-2">
         

        <div class="admonition caution">
          <p class="admonition-title">Caution</p>
          <p>
             You are
            reading an unstable version of this documentation.  If you want up-to-date information, please have a look at

            <a href="../../stable/design-notes/protocols.html">
               4.5  </a
            >.
          </p>
        </div>
        

        <div class="pre-content">
          <div class="pre-content__left"><div class="breadcrumbs">
  <span class="bread__item">
    <a
      href="https://scylla.docs.scylladb.com"
      class="bread__highlight"
    >
      <i class="fas fa-home"></i> Scylla Documentation</a
    ></span
  >
  
  <span class="bread__item"
    ><a href="index.html">Design Notes</a></span
  >
  
  <span class="bread__item bread__item--last">Ports and protocols in Scylla</span>
</div></div>
          <div class="pre-content__right"><ul
  class="dropdown menu scylla-dropdown scylla-dropdown--contribute"
  data-dropdown-menu
>
  <li class="scylla-dropdown__item">
    <a class="scylla-dropdown__title" href="#">
      <div class="scylla-dropdown__title--body">
        <i class="icon fa fa-github" aria-hidden="true"></i>
        Contribute
      </div>
      <i class="chevron scylla-icon scylla-icon--chevron-right"></i>
    </a>
    <ul class="menu scylla-dropdown__content">
      <li>
        <a
          href="https://github.com/scylladb/scylla/issues/new?title=Issue in page Ports and protocols in Scylla&&body=I%20would%20like%20to%20report%20an%20issue%20in%20page%20https://scylla.docs.scylladb.com/master/design-notes/protocols%0A%0A%23%23%23%20Problem%0A%0A%23%23%23%20%20Suggest%20a%20fix"
          target="_blank"
          >Report a doc issue
          <i class="icon fa fa-external-link" aria-hidden="true"></i
        ></a>
      </li>
      
      <li>
             
        <a
          href="https://github.com/scylladb/scylla/edit/master/docs/design-notes/protocols.md"
          target="_blank"
          >Edit this page
          <i class="icon fa fa-external-link" aria-hidden="true"></i
        ></a>
      </li>
      
      <li>
        <a href="https://docs.scylladb.com/contribute/" target="_blank"
          >Learn how to contribute
          <i class="icon fa fa-external-link" aria-hidden="true"></i
        ></a>
      </li>
    </ul>
  </li>
</ul></div>
        </div>
         <div class="section" id="ports-and-protocols-in-scylla">
<h1>Ports and protocols in Scylla<a class="headerlink" href="#ports-and-protocols-in-scylla" title="Permalink to this headline">¶</a></h1>
<p>Scylla is a distributed system, with multiple Scylla nodes communicating
with each other and with client nodes making requests. All these different
nodes use many different protocols and TCP ports (currently, all use TCP)
to communicate with each other. Some of these protocols have an external
specification - for example Scylla supports Cassandra’s CQL protocol and
Amazon’s DynamoDB protocol for client requests. Other protocols, both
client-facing and internal (between Scylla nodes), are Scylla-defined.</p>
<p>The goal of this document is to survey all these different protocols -
what goes over which protocol, which port each protocol uses (and how this
can be configured), how to disable or enable some of the protocols, and what
part of the Scylla source code handles which protocol.</p>
<p>Unfortunately, the long evolution of some of these protocols resulted in
some of them getting confusing names, and often different names in Scylla’s
code, documentation and configuration. This document aims to clear up some
of this confusion.</p>
<p>The Wireshark tool can be used to inspect and understand the messages sent
over many of the following protocols. This includes even Scylla’s internal
inter-node protocol - for instructions and examples check out the blog post:
https://www.scylladb.com/2020/05/21/dissecting-scylla-packets-with-wireshark/</p>
<div class="section" id="internal-communication">
<h2>Internal communication<a class="headerlink" href="#internal-communication" title="Permalink to this headline">¶</a></h2>
<p>All inter-node communiction - communication between the Scylla nodes
themselves - happen over one protocol and one TCP port - by default port 7000
(unencrypted) or 7001 (encrypted). These are the same TCP ports used by
Cassandra for this purpose, but Scylla’s internal protocol is completely
different from Cassandra, and incompatible with it (one cannot mix Scylla
and Cassandra nodes in a single cluster).</p>
<p>Scylla’s internal protocol is built on top of Seastar’s “RPC” messaging
mechanism, itself built on top of TCP. This protocol includes messages of
different types (“verbs”) - which are all listed in the source file
<code class="docutils literal notranslate"><span class="pre">message/messaging_service.cc</span></code>.</p>
<p>Here is a non-exhaustive list of things that Scylla does with these messages:</p>
<ul class="simple">
<li><p>“Gossip” between the nodes to maintain knowledge of the cluster topology:
Which nodes belong to the cluster, their state and token ownership.</p></li>
<li><p>Read and write (mutation) messages sent from a node receiving a client’s
request (a so-called coordinator) to a replica which holds relevant data.</p></li>
<li><p>In particular, mutations to special system tables are used to maintain
cluster-wide agreement on schemas (table definitions).</p></li>
<li><p>Streaming data to new nodes and repairing data between nodes.</p></li>
<li><p>Messages used to implement LWT (lightweight transactions).</p></li>
</ul>
<p>Although all these different types of messages use the same RPC protocol and
the same destination port on the receiver, we don’t want to multiplex all of
these messages over a <em>single</em> TCP connection. If we do, this would allow
messages of one type to severely delay messages of other types (head-of-line
blocking).  So Scylla opens several sockets to the same destination port
and uses a different socket for different message types.  The function
<code class="docutils literal notranslate"><span class="pre">do_get_rpc_client_idx</span></code> determines which types of messages get bunched
together over one socket. As of this writing, the different messages are
split into four sockets.</p>
<p>As everything in Scylla, the messaging service (providing this internal
communication) is a sharded service, so each shard keeps its own sockets
to each remote node. The remote node is also sharded. We cannot know for
sure which shard on the remote node will handle the messages, but we make
an effort (which is not a guarantee!) that if the two nodes have the same
number of shards, messages from shard N in the source node arrive to shard
N in the destination node.</p>
<p>Port 7000 is the default port for Scylla’s internal communication. This choice
can be overridden by the <code class="docutils literal notranslate"><span class="pre">storage_port</span></code> configuration option. This awkward
name, <code class="docutils literal notranslate"><span class="pre">storage_port</span></code>, was kept for backward compatibility with Cassandra’s
YAML configuration file. In very early Cassandra versions, this port was
used <em>only</em> for “storage” messages (read and write), and other messages such
as gossip were sent to a different port. So today we are still stuck with
this outdated name of this configuration option.</p>
<p>Configuring <code class="docutils literal notranslate"><span class="pre">storage_port</span></code> or <code class="docutils literal notranslate"><span class="pre">ssl_storage_port</span></code> to 0 disables listening
on the respective unecrypted/encrypted inter-node communication port.</p>
<p>There is also a <code class="docutils literal notranslate"><span class="pre">listen_address</span></code> configuration option to set the IP address
(and therefore network interface) on which Scylla should listen for the
internal protocol. This address defaults to <code class="docutils literal notranslate"><span class="pre">localhost</span></code>, but in any
setup except a one-node test, should be overridden.</p>
<p>TODO: there is also <code class="docutils literal notranslate"><span class="pre">listen_interface</span></code> option… Which wins? What’s the default?
TODO: mention SSL, how it is configured, and <code class="docutils literal notranslate"><span class="pre">ssl_storage_port</span></code> (default 7001).</p>
</div>
<div class="section" id="cql-client-protocol">
<h2>CQL client protocol<a class="headerlink" href="#cql-client-protocol" title="Permalink to this headline">¶</a></h2>
<p>The CQL binary protocol is Cassandra’s and Scylla’s main client-facing
protocol. Scylla supports several Scylla-only extensions to this protocol,
described in <a class="reference internal" href="protocol-extensions.html"><span class="doc">protocol-extensions.md</span></a>.</p>
<p>By default, Scylla listens to the CQL protocol on port 9042, which can be
configured via the <code class="docutils literal notranslate"><span class="pre">native_transport_port</span></code> configuration option. If set
to 0, the OS will choose the port randomly (which also applies to every CQL
port discussed later). To explicitly disable listening on a CQL port one
should set its value to <code class="docutils literal notranslate"><span class="pre">~</span></code> , or <code class="docutils literal notranslate"><span class="pre">null</span></code>.</p>
<p>Scylla also supports the CQL protocol via TLS/SSL encryption which is
disabled by default and can be enabled via the <code class="docutils literal notranslate"><span class="pre">native_transport_port_ssl</span></code>
configuration option. Traditional choice for the port for secure
connections is 9142, but if <code class="docutils literal notranslate"><span class="pre">client_encryption_options</span></code> are specified and
<code class="docutils literal notranslate"><span class="pre">native_transport_port_ssl</span></code> is not, then <code class="docutils literal notranslate"><span class="pre">native_transport_port</span></code> will
handle encrypted connections only. The same thing happens when
<code class="docutils literal notranslate"><span class="pre">native_transport_port</span></code> and <code class="docutils literal notranslate"><span class="pre">native_transport_port_ssl</span></code> are set to the same
value. The rules governing port assignment/encryption are summed up in
the table below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">np</span>  <span class="p">:</span><span class="o">=</span> <span class="n">native_transport_port</span> <span class="ow">is</span> <span class="nb">set</span>
<span class="n">nps</span> <span class="p">:</span><span class="o">=</span> <span class="n">native_transport_port_ssl</span> <span class="ow">is</span> <span class="nb">set</span>
<span class="n">ceo</span> <span class="p">:</span><span class="o">=</span> <span class="n">client_encryption_options</span> <span class="n">are</span> <span class="n">enabled</span>
<span class="n">eq</span>  <span class="p">:</span><span class="o">=</span> <span class="n">native_transport_port_ssl</span> <span class="o">==</span> <span class="n">native_transport_port</span>

<span class="o">+-----+-----+-----+-----+</span>
<span class="o">|</span>  <span class="n">np</span> <span class="o">|</span> <span class="n">nps</span> <span class="o">|</span> <span class="n">ceo</span> <span class="o">|</span>  <span class="n">eq</span> <span class="o">|</span>
<span class="o">+-----+-----+-----+-----+</span>
<span class="o">|</span>  <span class="mi">0</span>  <span class="o">|</span>  <span class="mi">0</span>  <span class="o">|</span>  <span class="mi">0</span>  <span class="o">|</span>  <span class="o">*</span>  <span class="o">|</span>   <span class="o">=&gt;</span>   <span class="n">listen</span> <span class="n">on</span> <span class="n">native_transport_port</span><span class="p">,</span> <span class="n">unencrypted</span>
<span class="o">|</span>  <span class="mi">0</span>  <span class="o">|</span>  <span class="mi">0</span>  <span class="o">|</span>  <span class="mi">1</span>  <span class="o">|</span>  <span class="o">*</span>  <span class="o">|</span>   <span class="o">=&gt;</span>   <span class="n">listen</span> <span class="n">on</span> <span class="n">native_transport_port</span><span class="p">,</span> <span class="n">encrypted</span>
<span class="o">|</span>  <span class="mi">0</span>  <span class="o">|</span>  <span class="mi">1</span>  <span class="o">|</span>  <span class="mi">0</span>  <span class="o">|</span>  <span class="o">*</span>  <span class="o">|</span>   <span class="o">=&gt;</span>   <span class="n">don</span><span class="s1">&#39;t listen</span>
<span class="o">|</span>  <span class="mi">0</span>  <span class="o">|</span>  <span class="mi">1</span>  <span class="o">|</span>  <span class="mi">1</span>  <span class="o">|</span>  <span class="o">*</span>  <span class="o">|</span>   <span class="o">=&gt;</span>   <span class="n">listen</span> <span class="n">on</span> <span class="n">native_transport_port_ssl</span><span class="p">,</span> <span class="n">encrypted</span>
<span class="o">|</span>  <span class="mi">1</span>  <span class="o">|</span>  <span class="mi">0</span>  <span class="o">|</span>  <span class="mi">0</span>  <span class="o">|</span>  <span class="o">*</span>  <span class="o">|</span>   <span class="o">=&gt;</span>   <span class="n">listen</span> <span class="n">on</span> <span class="n">native_transport_port</span><span class="p">,</span> <span class="n">unencrypted</span>
<span class="o">|</span>  <span class="mi">1</span>  <span class="o">|</span>  <span class="mi">0</span>  <span class="o">|</span>  <span class="mi">1</span>  <span class="o">|</span>  <span class="o">*</span>  <span class="o">|</span>   <span class="o">=&gt;</span>   <span class="n">listen</span> <span class="n">on</span> <span class="n">native_transport_port</span><span class="p">,</span> <span class="n">encrypted</span>
<span class="o">|</span>  <span class="mi">1</span>  <span class="o">|</span>  <span class="mi">1</span>  <span class="o">|</span>  <span class="mi">0</span>  <span class="o">|</span>  <span class="o">*</span>  <span class="o">|</span>   <span class="o">=&gt;</span>   <span class="n">listen</span> <span class="n">on</span> <span class="n">native_transport_port</span><span class="p">,</span> <span class="n">unencrypted</span>
<span class="o">|</span>  <span class="mi">1</span>  <span class="o">|</span>  <span class="mi">1</span>  <span class="o">|</span>  <span class="mi">1</span>  <span class="o">|</span>  <span class="mi">0</span>  <span class="o">|</span>   <span class="o">=&gt;</span>   <span class="n">listen</span> <span class="n">on</span> <span class="n">native_transport_port</span><span class="p">,</span> <span class="n">unencrypted</span> <span class="o">+</span> <span class="n">native_transport_port_ssl</span><span class="p">,</span> <span class="n">encrypted</span>
<span class="o">|</span>  <span class="mi">1</span>  <span class="o">|</span>  <span class="mi">1</span>  <span class="o">|</span>  <span class="mi">1</span>  <span class="o">|</span>  <span class="mi">1</span>  <span class="o">|</span>   <span class="o">=&gt;</span>   <span class="n">listen</span> <span class="n">on</span> <span class="n">native_transport_port</span><span class="p">(</span><span class="n">_ssl</span> <span class="o">-</span> <span class="n">same</span> <span class="n">thing</span><span class="p">),</span> <span class="n">encrypted</span>
<span class="o">+-----+-----+-----+-----+</span>
</pre></div>
</div>
<p>To allow “advanced shard-awareness” Scylla can accept CQL connections on
additional port(s): <code class="docutils literal notranslate"><span class="pre">native_shard_aware_transport_port</span></code> (by default 19042)
and <code class="docutils literal notranslate"><span class="pre">native_shard_aware_transport_port_ssl</span></code> (encrypted, disabled by default
just like <code class="docutils literal notranslate"><span class="pre">native_transport_port_ssl</span></code>). The typical choice for
<code class="docutils literal notranslate"><span class="pre">native_shard_aware_transport_port_ssl</span></code> is 19142.</p>
<p>Both shard-aware ports work almost identically as their non-shard-aware
counterparts, with only one difference: client connections arriving on
“shard-aware” ports are routed to specific shards, determined by the
client-side (local) port numbers. This feature is enabled by default and can
be disabled by setting <code class="docutils literal notranslate"><span class="pre">enable_shard_aware_drivers:</span> <span class="pre">false</span></code>.</p>
<p>The CQL protocol support can be disabled altogether by setting the
<code class="docutils literal notranslate"><span class="pre">start_native_transport</span></code> option to <code class="docutils literal notranslate"><span class="pre">false</span></code>.</p>
<p>These option names were chosen for backward-compatibility with Cassandra
configuration files: they refer to CQL as the “native transport”, to
contrast with the older Thrift protocol (described below) which wasn’t
native to Cassandra.</p>
<p>There is also a <code class="docutils literal notranslate"><span class="pre">rpc_address</span></code> configuration option to set the IP address
(and therefore network interface) on which Scylla should listen for the
CQL protocol. This address defaults to <code class="docutils literal notranslate"><span class="pre">localhost</span></code>, but in any setup except
a one-node test, should be overridden. Note that the same option <code class="docutils literal notranslate"><span class="pre">rpc_address</span></code>
applies to both CQL and Thrift protocols.</p>
<p>TODO: there is also <code class="docutils literal notranslate"><span class="pre">rpc_interface</span></code> option… Which wins? What’s the default?</p>
</div>
<div class="section" id="thrift-client-protocol">
<h2>Thrift client protocol<a class="headerlink" href="#thrift-client-protocol" title="Permalink to this headline">¶</a></h2>
<p>The Apache Thrift protocol was early Cassandra’s client protocol, until
it was superseded in Cassandra 1.2 with the binary CQL protocol. Thrift
was still nominally supported by both Cassandra and Scylla for many years,
but was recently dropped in Cassandra (version 4.0) and is likely to be
dropped by Scylla in the future as well, so it is not recommended for new
applications.</p>
<p>By default, Scylla does not enable the Thrift server. In order to use it,
it must be explicitly enabled by setting the <code class="docutils literal notranslate"><span class="pre">start_rpc</span></code> configuration option
to true.</p>
<p>When Thrift is enabled, by default scylla listens to the Thrift protocol on port 9160,
which can be configured via the <code class="docutils literal notranslate"><span class="pre">rpc_port</span></code> configuration option. Again, this confusing
name was used for backward-compatibility with Cassandra’s configuration files.
Cassandra used the term “rpc” because Apache Thrift is a remote procedure
call (RPC) framework. In Scylla, this name is especially confusing, because
as mentioned above, Scylla’s internal communication protocol is based on
Seastar’s RPC, which has nothing to do with the “<code class="docutils literal notranslate"><span class="pre">rpc_port</span></code>” described here.</p>
<p>There is also a <code class="docutils literal notranslate"><span class="pre">rpc_address</span></code> configuration option to set the IP address
(and therefore network interface) on which Scylla should listen for the
Thrift protocol. This address defaults to <code class="docutils literal notranslate"><span class="pre">localhost</span></code>, but in any
setup except a one-node test, should be overridden. Note that the same
option <code class="docutils literal notranslate"><span class="pre">rpc_address</span></code> applies to both CQL and Thrift protocols.</p>
<p>TODO: there is also <code class="docutils literal notranslate"><span class="pre">rpc_interface</span></code> option… Which wins? What’s the default?
TODO: is there an SSL version of Thrift?</p>
</div>
<div class="section" id="dynamodb-client-protocol">
<h2>DynamoDB client protocol<a class="headerlink" href="#dynamodb-client-protocol" title="Permalink to this headline">¶</a></h2>
<p>Scylla also supports Amazon’s DynamoDB API. The DynamoDB API is a JSON over
HTTP (unencrypted) or HTTPS (encrypted) protocol. Support for this protocol
is not turned on by default, and must be turned on manually by setting
the <code class="docutils literal notranslate"><span class="pre">alternator_port</span></code> and/or <code class="docutils literal notranslate"><span class="pre">alternator_https_port</span></code> configuration options.
“Alternator” is the codename of Scylla’s DynamoDB API support, and is
documented in more detail in <a class="reference internal" href="../alternator/alternator.html"><span class="doc">alternator.md</span></a>.</p>
<p>The standard ports that DynamoDB uses are the standard HTTP and HTTPS
ports (80 and 443, respectively), but in tests we usually use the
unprivileged port numbers 8000 and 8043 instead.</p>
<p>There is also an <code class="docutils literal notranslate"><span class="pre">alternator_address</span></code> configuration option to set the IP
address (and therefore network interface) on which Scylla should listen
for the DynamoDB protocol. This address defaults to 0.0.0.0.</p>
<p>When the HTTPS-based protocol is enabled, the server also needs to know
the certificate and key files to use. The default locations of these files
are <code class="docutils literal notranslate"><span class="pre">/etc/scylla/scylla.crt</span></code> and <code class="docutils literal notranslate"><span class="pre">/etc/scylla/scylla.key</span></code> respectively, but
can be overridden by specifying in <code class="docutils literal notranslate"><span class="pre">alternator_encryption_options</span></code> the
<code class="docutils literal notranslate"><span class="pre">keyfile</span></code> and <code class="docutils literal notranslate"><span class="pre">certificate</span></code> options. For example,
<code class="docutils literal notranslate"><span class="pre">--alternator-encryption-options</span> <span class="pre">keyfile=&quot;...&quot;</span></code>.</p>
</div>
<div class="section" id="redis-client-protocol">
<h2>Redis client protocol<a class="headerlink" href="#redis-client-protocol" title="Permalink to this headline">¶</a></h2>
<p>Scylla also has partial and experimental support for the Redis API.
Because this support is experimental, it is not turned on by
default, and must be turned on manually by setting the <code class="docutils literal notranslate"><span class="pre">redis_port</span></code>
and/or <code class="docutils literal notranslate"><span class="pre">redis_ssl_port</span></code> configuration option.</p>
<p>The traditional port used for Redis is 6379. Regular Redis does not
support SSL, so there is no traditional choice of port for it.</p>
<p>See <a class="reference internal" href="redis.html"><span class="doc">redis.md</span></a> for more information about Scylla’s
support for the Redis protocol.</p>
</div>
<div class="section" id="metrics-protocol">
<h2>Metrics protocol<a class="headerlink" href="#metrics-protocol" title="Permalink to this headline">¶</a></h2>
<p>Scylla provides an HTTP-based protocol to fetch performance and activity
metrics from Scylla, which is described in detail in <a class="reference internal" href="metrics.html"><span class="doc">metrics.md</span></a>.</p>
<p>Scylla listens by default on port 9180 for metric requests. This port number
can be configured with the <code class="docutils literal notranslate"><span class="pre">prometheus_port</span></code> configuration option, named
after the Prometheus protocol - and the Prometheus server which is usually
used to collect these metrics.</p>
<p>There is also a <code class="docutils literal notranslate"><span class="pre">prometheus_address</span></code> configuration option to set the IP
address (and therefore network interface) on which Scylla should listen
for the metrics protocol. This address defaults to 0.0.0.0.</p>
</div>
<div class="section" id="rest-api-protocol">
<h2>REST API protocol<a class="headerlink" href="#rest-api-protocol" title="Permalink to this headline">¶</a></h2>
<p>The CQL client protocol mentioned above is useful mostly for data and table
requests, but does not offer commands for <em>administrative</em> operations such
as repair, compact, adding or removing nodes, and so on. Cassandra uses
nodetool and JMX for these (see below), but Scylla’s native approach is a
RESTful API (HTTP requests).</p>
<p>Scylla listens for this REST API by default on port 10000, which can be
configured with the <code class="docutils literal notranslate"><span class="pre">api_port</span></code> configuration option.</p>
<p>The REST API has no notion of authentication of authorization, and allows
anyone connecting to it to perform destructive operations. Therefore, it
only listens for connection on the localhost (127.0.0.1) interface. This
default can be overridden by the <code class="docutils literal notranslate"><span class="pre">api_address</span></code> option - but shouldn’t.</p>
<p>The available REST API commands are listed in JSON files in the <code class="docutils literal notranslate"><span class="pre">api/api-doc/</span></code>
directory of the Scylla source. A user can explore this API interactively
by pointing a browser to http://localhost:10000/ui/.</p>
<p>There is an ongoing, but incomplete, effort to replace this REST API by
a newer, “v2”, API. See <a class="reference internal" href="../guides/api_v2.html"><span class="doc">api_v2.md</span></a>. When complete, this v2
API will be available on the same port. You can explore the little it
offers now in the aforementioned UI by replacing the URL in the box with
“http://localhost:10000/v2”.</p>
</div>
<div class="section" id="jmx">
<h2>JMX<a class="headerlink" href="#jmx" title="Permalink to this headline">¶</a></h2>
<p>The “nodetool” management command connects to Scylla using Java’s JMX
protocol, not the REST API described above. This protocol was kept for
backward compatibility with Cassandra and its unmodified “nodetool” command.
To implement the JMX protocol, we have a separate project,
<a class="reference external" href="https://github.com/scylladb/scylla-jmx">scylla-jmx</a>, which runs a Java
program which accepts the JMX requests supported by Cassandra, and translates
them to requests to our own REST API. These REST API requests are sent
to Scylla’s REST API port over the loopback (localhost) interface.</p>
<p>The port on which scylla-jmx listens is by default port 7199. This port,
and the listen address, can be overridden with the <code class="docutils literal notranslate"><span class="pre">-jp</span></code> and <code class="docutils literal notranslate"><span class="pre">-ja</span></code> options
(respectively) of the <code class="docutils literal notranslate"><span class="pre">scylla-jmx</span></code> script.</p>
</div>
</div>
  <div class="content-navigation">
  <div class="navigation navigation--prev">
    <a class="navigation__link" href="protocol-extensions.html">
      <button class="navigation__button">
        <i class="scylla-icon scylla-icon--chevron-left"></i>
      </button>
      <div class="navigation__title">
        <span class="colored">PREVIOUS</span> <br />Protocol extensions to the Cassandra Native Protocol
      </div>
    </a>
  </div>
  <div class="navigation navigation--next">
    <a class="navigation__link" href="redis.html">
      <div class="navigation__title">
        <span class="colored">NEXT</span> <br />Redis API in Scylla
      </div>
      <button class="navigation__button">
        <i class="scylla-icon scylla-icon--chevron-right"></i>
      </button>
    </a>
  </div>
</div> 
      </div>
      <div
        class="sidebar-left  large-order-1"
      > <div id="side-nav" class="side-nav" data-closable data-toggler=".show">
  <div class="side-nav__search">
    <div class="search-box">
      <ci-search></ci-search>
    </div>
  </div>
  <div class="side-nav__versions">
     <ul
  class="dropdown menu scylla-dropdown scylla-dropdown--versions "
  data-dropdown-menu
>
  <li class="scylla-dropdown__item">
    <a class="scylla-dropdown__title" href="#">
       master 
      <i class="chevron scylla-icon scylla-icon--chevron-right"></i>
    </a>
    <ul class="menu scylla-dropdown__content"> 
      <li>
        <a href="../../stable/design-notes/protocols.html"
          >4.5</a
        >
      </li>
       
      <li>
        <a href="../../branch-4.4/design-notes/protocols.html"
          >4.4</a
        >
      </li>
       
    </ul>
  </li>
</ul> 
  </div>
  <div class="side-nav__content">
    <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../index.html">Scylla Developer Documentation</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../alternator/alternator.html">Alternator: DynamoDB API in Scylla</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label for="toctree-checkbox-1"><i class="scylla-icon scylla-icon--expand"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../alternator/getting-started.html">Getting Started With ScyllaDB Alternator</a></li>
<li class="toctree-l2"><a class="reference internal" href="../alternator/compatibility.html">Scylla Alternator for DynamoDB users</a></li>
</ul>
</li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="index.html">Design Notes</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label for="toctree-checkbox-2"><i class="scylla-icon scylla-icon--expand"></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="IDL.html">IDL compiler</a></li>
<li class="toctree-l2"><a class="reference internal" href="cdc.html">CDC</a></li>
<li class="toctree-l2"><a class="reference internal" href="compaction_controller.html">The Compaction Controller</a></li>
<li class="toctree-l2"><a class="reference internal" href="cql-extensions.html">Scylla CQL extensions</a></li>
<li class="toctree-l2"><a class="reference internal" href="cql-extensions-internal.html">Scylla CQL extensions</a></li>
<li class="toctree-l2"><a class="reference internal" href="cql3-type-mapping.html">CQL3 Type Mapping</a></li>
<li class="toctree-l2"><a class="reference internal" href="hinted_handoff_design.html">Hinted Handoff Design</a></li>
<li class="toctree-l2"><a class="reference internal" href="isolation.html">Performance Isolation in Scylla</a></li>
<li class="toctree-l2"><a class="reference internal" href="lua-type-mapping.html">CQL to Lua type mapping</a></li>
<li class="toctree-l2"><a class="reference internal" href="metrics.html">Scylla Metrics</a></li>
<li class="toctree-l2"><a class="reference internal" href="migrating-from-users-to-roles.html">Migrating from users to roles</a></li>
<li class="toctree-l2"><a class="reference internal" href="paged-queries.html">Paged queries</a></li>
<li class="toctree-l2"><a class="reference internal" href="protocol-extensions.html">Protocol extensions to the Cassandra Native Protocol</a></li>
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">Ports and protocols in Scylla</a></li>
<li class="toctree-l2"><a class="reference internal" href="redis.html">Redis API in Scylla</a></li>
<li class="toctree-l2"><a class="reference internal" href="repair_based_node_ops.html">Repair based node operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="reverse-reads.html">Reverse reads</a></li>
<li class="toctree-l2"><a class="reference internal" href="row_cache.html">Row Cache</a></li>
<li class="toctree-l2"><a class="reference internal" href="row_level_repair.html">Row level repair</a></li>
<li class="toctree-l2"><a class="reference internal" href="secondary_index.html">Secondary indexes in Scylla</a></li>
<li class="toctree-l2"><a class="reference internal" href="sstable-scylla-format.html">File format of the Scylla.db sstable component</a></li>
<li class="toctree-l2"><a class="reference internal" href="sstables-directory-structure.html">sstables directory structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="system_keyspace.html">System keyspace layout</a></li>
<li class="toctree-l2"><a class="reference internal" href="system_keyspace.html#virtual-tables-in-the-system-keyspace">Virtual tables in the system keyspace</a></li>
<li class="toctree-l2"><a class="reference internal" href="system_schema_keyspace.html">System schema keyspace layout</a></li>
<li class="toctree-l2"><a class="reference internal" href="wasm.html">WASM support for user-defined functions</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../guides/index.html">Guides</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label for="toctree-checkbox-3"><i class="scylla-icon scylla-icon--expand"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../guides/HACKING.html">Guidelines for developing Scylla</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guides/api_v2.html">Scylla RESTful API V2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guides/building.html">Building Scylla</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guides/debugging.html">Debugging with GDB</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guides/docker-hub.html">Docker Hub Image</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guides/logging.html">Logging in Scylla</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guides/testing.html">Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guides/tracing.html">Tracing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guides/virtual-tables.html">Virtual Tables</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../contribute/index.html">Contribute</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label for="toctree-checkbox-4"><i class="scylla-icon scylla-icon--expand"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../contribute/CONTRIBUTING.html">Contributing to Scylla</a></li>
<li class="toctree-l2"><a class="reference internal" href="../contribute/backport.html">Backport</a></li>
<li class="toctree-l2"><a class="reference internal" href="../contribute/maintainer.html">Maintainer’s handbook</a></li>
<li class="toctree-l2"><a class="reference internal" href="../contribute/review-checklist.html">Review Checklist</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../service_levels.html">Service Level Distributed Data</a></li>
</ul>

  </div>
</div>
      </div>
      
      <div class="sidebar-right large-order-3">
         <div class="secondary-side-nav">
  <div class="secondary-side-nav__content">
    <p class="topic-title">On this page</p>
    <ul>
<li><a class="reference internal" href="#">Ports and protocols in Scylla</a><ul>
<li><a class="reference internal" href="#internal-communication">Internal communication</a></li>
<li><a class="reference internal" href="#cql-client-protocol">CQL client protocol</a></li>
<li><a class="reference internal" href="#thrift-client-protocol">Thrift client protocol</a></li>
<li><a class="reference internal" href="#dynamodb-client-protocol">DynamoDB client protocol</a></li>
<li><a class="reference internal" href="#redis-client-protocol">Redis client protocol</a></li>
<li><a class="reference internal" href="#metrics-protocol">Metrics protocol</a></li>
<li><a class="reference internal" href="#rest-api-protocol">REST API protocol</a></li>
<li><a class="reference internal" href="#jmx">JMX</a></li>
</ul>
</li>
</ul>

  </div>
</div> 
      </div>
    </section>

    <footer class="footer">
  <div class="footer-group">
    <div class="footer-top">
      <a class="footer-logo" href="https://www.scylladb.com"
        ><img
          src="../_static/img/logo-scylla-horizontal-RGB.svg"
          alt="Logo"
      /></a>
      <div class="footer-links">
        <a class="footer-links__link" href="https://docs.scylladb.com/">Docs</a>
        <a
          class="footer-links__link"
          href="https://www.scylladb.com/company/contact-us/"
          >Contact Us</a
        >
        <a class="footer-links__link" href="https://www.scylladb.com/company/"
          >About Us</a
        >
      </div>
      <div class="footer-actions">
        <a
          class="footer-actions__link"
          href="https://groups.google.com/g/scylladb-users"
          target="_blank"
          ><span
            data-tooltip
            tabindex="1"
            title="User mailing list"
            data-position="bottom"
          >
            <img
              src="../_static/img/icons/icon-mail-list.svg"
              alt="Mail List Icon"
            />
          </span>
        </a>
        <a
          class="footer-actions__link"
          href="http://slack.scylladb.com/"
          target="_blank"
          ><span
            data-tooltip
            tabindex="1"
            title="User Slack channel"
            data-position="bottom"
          >
            <img
              src="../_static/img/icons/icon-slack.svg"
              alt="Slack Icon"
          /></span>
        </a>
      </div>
    </div>

    <div class="footer-bottom">
      <div class="footer-bottom__copyright"> &#169; 2021, ScyllaDB. All rights reserved.
      </div>
      <div class="footer-bottom__last-updated">
        Last updated on 02 December 2021.
      </div>
      <div class="footer-bottom__version">
        Powered by
        <a href="http://sphinx-doc.org/">Sphinx 2.4.4</a> &amp;
        <a href="https://sphinx-theme.scylladb.com/"
          >ScyllaDB Theme 1.0.5</a
        >
      </div>
    </div>
  </div>
</footer>

    <noscript>
      <iframe
        src="https://www.googletagmanager.com/ns.html?id=GTM-T8P2JP"
        height="0"
        width="0"
        style="display: none; visibility: hidden"
      ></iframe>
    </noscript>
  </body>
</html>